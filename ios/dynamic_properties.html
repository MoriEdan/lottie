
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Building a Dynamic Progress Loader Â· Lottie</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-prism/prism.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-collapsible-chapters/collapsible-chapters.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-anchors/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../android/android.html">
            
                <a href="../android/android.html">
            
                    
                    Android
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../android/android.html">
            
                <a href="../android/android.html#getting-started">
            
                    
                    Getting Started
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="../android/android.html">
            
                <a href="../android/android.html#sample-app">
            
                    
                    Sample App
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="../android/basic-workflow.html">
            
                <a href="../android/basic-workflow.html">
            
                    
                    Basic Workflow
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4" data-path="../android/dynamic.html">
            
                <a href="../android/dynamic.html">
            
                    
                    Dynamic Properties
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5" data-path="../android/images.html">
            
                <a href="../android/images.html">
            
                    
                    Images
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.6" data-path="../android/performance.html">
            
                <a href="../android/performance.html">
            
                    
                    Performance
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.7" data-path="../android/avd.html">
            
                <a href="../android/avd.html">
            
                    
                    Lottie vs AVD
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.8" data-path="../android/apk-size.md">
            
                <span>
            
                    
                    APK size
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.9" data-path="../android/troubleshooting.html">
            
                <a href="../android/troubleshooting.html">
            
                    
                    Troubleshooting
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../ios.html">
            
                <a href="../ios.html">
            
                    
                    iOS/MacOS
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" >
            
                <span>
            
                    
                    Docs
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1.1" data-path="../ios.html">
            
                <a href="../ios.html#getting-started-on-ios-or-macos">
            
                    
                    Getting Started
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.2" data-path="../ios.html">
            
                <a href="../ios.html#installing-lottie">
            
                    
                    Installing Lottie
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.3" data-path="../ios.html">
            
                <a href="../ios.html#ios-sample-app">
            
                    
                    iOS Sample App
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.4" data-path="../ios.html">
            
                <a href="../ios.html#macos-sample-app">
            
                    
                    MacOS Sample App
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.5" data-path="../ios.html">
            
                <a href="../ios.html#objective-c-examples">
            
                    
                    Objective C Examples
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.6" data-path="../ios.html">
            
                <a href="../ios.html#swift-examples">
            
                    
                    Swift Examples
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.7" data-path="view-controllers.html">
            
                <a href="view-controllers.html">
            
                    
                    View Controller Transitions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.8" data-path="dynamic.html">
            
                <a href="dynamic.html">
            
                    
                    Dynamic Properties
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.9" data-path="addsubviews.html">
            
                <a href="addsubviews.html">
            
                    
                    Adding Views to Animation at Runtime
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.2" >
            
                <span>
            
                    
                    Tutorials
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter active" data-level="1.3.2.1" data-path="dynamic_properties.html">
            
                <a href="dynamic_properties.html">
            
                    
                    Building a Dynamic Progress Loader
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.3" >
            
                <span>
            
                    
                    Troubleshooting
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.3.1" data-path="performance.html">
            
                <a href="performance.html">
            
                    
                    Performance
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3.2" data-path="troubleshooting.html">
            
                <a href="troubleshooting.html">
            
                    
                    Troubleshooting
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../react-native/react-native.html">
            
                <a href="../react-native/react-native.html">
            
                    
                    React Native
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../react-native/react-native.html">
            
                <a href="../react-native/react-native.html#getting-started">
            
                    
                    Getting Started
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../react-native/sample-app.html">
            
                <a href="../react-native/sample-app.html">
            
                    
                    Sample App
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="../react-native/props.html">
            
                <a href="../react-native/props.html">
            
                    
                    Props
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="../react-native/troubleshooting.html">
            
                <a href="../react-native/troubleshooting.html">
            
                    
                    Troubleshooting
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../web/web.html">
            
                <a href="../web/web.html">
            
                    
                    Web
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="../web/getting-started.html">
            
                <a href="../web/getting-started.html">
            
                    
                    Getting started
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" >
            
                <a target="_blank" href="https://www.youtube.com/watch?v=5XMUJdjI0L8">
            
                    
                    Video tutorial
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="../web/previewing.html">
            
                <a href="../web/previewing.html">
            
                    
                    Previewing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.4" data-path="../web/expressions.html">
            
                <a href="../web/expressions.html">
            
                    
                    Expressions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.5" data-path="../after-effects/troubleshooting.html">
            
                <a href="../after-effects/troubleshooting.html">
            
                    
                    Troubleshooting
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="../after-effects/getting-started.html">
            
                <a href="../after-effects/getting-started.html">
            
                    
                    After Effects
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="../after-effects/getting-started.html">
            
                <a href="../after-effects/getting-started.html">
            
                    
                    Getting started
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="../after-effects/bodymovin-installation.html">
            
                <a href="../after-effects/bodymovin-installation.html">
            
                    
                    Install Bodymovin Plugin
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.2.1" data-path="../after-effects/bodymovin-settings.html">
            
                <a href="../after-effects/bodymovin-settings.html">
            
                    
                    Bodymovin settings
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6.3" data-path="../after-effects/general-tips.html">
            
                <a href="../after-effects/general-tips.html">
            
                    
                    General tips & guidelines
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.4" data-path="../after-effects/artwork-to-lottie-walkthrough.html">
            
                <a href="../after-effects/artwork-to-lottie-walkthrough.html">
            
                    
                    Sketch/SVG/Illustrator to Lottie walkthrough
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.5" data-path="../after-effects/illustrator-to-lottie-walkthrough.html">
            
                <a href="../after-effects/illustrator-to-lottie-walkthrough.html">
            
                    
                    Advanced Illustrator to Lottie walkthrough
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.6" data-path="../after-effects/troubleshooting.html">
            
                <a href="../after-effects/troubleshooting.html">
            
                    
                    Troubleshooting
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="../supported-features.html">
            
                <a href="../supported-features.html">
            
                    
                    Supported After Effects Features
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="../other-platforms.html">
            
                <a href="../other-platforms.html">
            
                    
                    Other Platforms
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1" >
            
                <span>
            
                    
                    Mobile
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1.1" >
            
                <a target="_blank" href="https: //github.com/martijn00/LottieXamarin">
            
                    
                    Xamarin
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.1.2" >
            
                <a target="_blank" href="https://github.com/bradmartin/nativescript-lottie">
            
                    
                    NativeScript
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.1.3" >
            
                <a target="_blank" href="https://github.com/m1ga/ti.animation">
            
                    
                    Titanium
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.1.4" >
            
                <a target="_blank" href="https://github.com/azchohfi/LottieUWP">
            
                    
                    Windows (UWP)
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8.2" >
            
                <span>
            
                    
                    Web Frameworks
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.2.1" >
            
                <a target="_blank" href="https://github.com/chenqingspring/react-lottie">
            
                    
                    React
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2.2" >
            
                <a target="_blank" href="https://github.com/chenqingspring/vue-lottie">
            
                    
                    Vue
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2.3" >
            
                <a target="_blank" href="https://github.com/chenqingspring/ng-lottie">
            
                    
                    Angular
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="../troubleshooting.html">
            
                <a href="../troubleshooting.html">
            
                    
                    Troubleshooting
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="../community-showcase.html">
            
                <a href="../community-showcase.html">
            
                    
                    Community Showcase
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Building a Dynamic Progress Loader</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
                                <section class="normal markdown-section">
                                
                                <h1 id="building-a-dynamic-progress-loader-with-lottie"><a name="building-a-dynamic-progress-loader-with-lottie" class="plugin-anchor" href="#building-a-dynamic-progress-loader-with-lottie"><i class="fa fa-link" aria-hidden="true"></i></a>Building a Dynamic Progress Loader with Lottie</h1>
<p>In this guide we will build a determinate progress loader with Lottie.
Determinate loaders are animations that show the progress of a download in real-time. Using Lottie&apos;s dynamic properties API we can change an animation while it plays it in response to a download progress.</p>
<p><img src="../images/Boat_Loader_Final.gif" alt="Boat_Loader_Animation"></p>
<p>The final animation will be a boat rolling over the ocean, as the download reaches 100% the water will fill the screen. Once the download finishes a completion animation will play.</p>
<p>You can find the animation&apos;s After Effects file and Lottie JSON <a href="../AEP/Boat_Loader.zip">Here</a></p>
<h2 id="the-animation"><a name="the-animation" class="plugin-anchor" href="#the-animation"><i class="fa fa-link" aria-hidden="true"></i></a>The Animation</h2>
<p>This guide will not cover how to make an animation in After Effects, but we should know how the file we are working with is structured. The dynamic properties API in Lottie allows us to change the key-frame data backing a Lottie animation while the animation is playing. These animation properties match animation properties in After Effects.</p>
<p><img src="../images/Boat_Loader_Comp.png" alt="Boat_Loader_Comp"></p>
<p>Our <code>Boat_Loader</code> animation has five layers in it: <code>Success</code>, <code>Boat</code>, <code>Chest</code>, <code>Fish</code> and <code>Bg</code>. Each of these layers have a number of properties we can change under <code>Transform</code>: <code>Position</code>, <code>Rotation</code>, <code>Scale</code>, <code>Opacity</code>. Some of these layers are a Precomp (Which stands for pre-composition); a layer that wraps another group of layers. We can even access the properties of a precomp&apos;s child layers if we would like. For this exercise we will just stick to moving the water and the boat.</p>
<p><img src="../images/Boat_Loader.gif" alt="Boat_Loader"></p>
<p>Playing the animation as-is will animate the rolling waves for a second, then the waves disappear suddenly and the treasure chest opens. The animation has been built in two parts. The first half is a loop that will show the waves rolling forever. The second half is the success animation. Playing the animation from the end of a loop into the success animation is seamless. As the download progresses we want the water to fill the screen. We will need to manually move the waves up the screen by changing the <code>Wave</code> layer&apos;s <code>Position</code> property. Once the download is finished we will finish the current animation loop and then play the last half of the animation once to show the success.</p>
<h2 id="getting-started"><a name="getting-started" class="plugin-anchor" href="#getting-started"><i class="fa fa-link" aria-hidden="true"></i></a>Getting Started</h2>
<p>Let&apos;s start with some ground work. We need a new ViewController and a large download to track. Create a new UIViewController subclass, and import Lottie. In keeping with the maritime theme, the file we will be downloading is a 10mb oceanography map. Now lets create a network request to download our map.</p>
<h4 id="swift"><a name="swift" class="plugin-anchor" href="#swift"><i class="fa fa-link" aria-hidden="true"></i></a>Swift:</h4>
<pre class="language-"><code class="lang-swift"><span class="token keyword">var</span> downloadTask<span class="token punctuation">:</span> <span class="token builtin">URLSessionDownloadTask</span><span class="token operator">?</span>

<span class="token keyword">func</span> <span class="token function">createDownloadTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> downloadRequest <span class="token operator">=</span> <span class="token function">URLRequest</span><span class="token punctuation">(</span>url<span class="token punctuation">:</span> <span class="token function">URL</span><span class="token punctuation">(</span>string<span class="token punctuation">:</span> <span class="token string">&quot;https://upload.wikimedia.org/wikipedia/commons/f/ff/Pizigani_1367_Chart_10MB.jpg&quot;</span><span class="token punctuation">)</span><span class="token operator">!</span><span class="token punctuation">)</span>
    <span class="token keyword">let</span> session <span class="token operator">=</span> <span class="token function">URLSession</span><span class="token punctuation">(</span>configuration<span class="token punctuation">:</span> <span class="token builtin">URLSessionConfiguration</span><span class="token punctuation">.</span><span class="token keyword">default</span><span class="token punctuation">,</span> delegate<span class="token punctuation">:</span> <span class="token keyword">self</span><span class="token punctuation">,</span> delegateQueue<span class="token punctuation">:</span> <span class="token builtin">OperationQueue</span><span class="token punctuation">.</span>main<span class="token punctuation">)</span>

    downloadTask <span class="token operator">=</span> session<span class="token punctuation">.</span><span class="token function">downloadTask</span><span class="token punctuation">(</span>with<span class="token punctuation">:</span>downloadRequest<span class="token punctuation">)</span>
    downloadTask<span class="token operator">!</span><span class="token punctuation">.</span><span class="token function">resume</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
 <span class="token punctuation">}</span>
</code></pre>
<h4 id="objective-c"><a name="objective-c" class="plugin-anchor" href="#objective-c"><i class="fa fa-link" aria-hidden="true"></i></a>Objective-C:</h4>
<pre class="language-"><code class="lang-objectivec"><span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>createDownloadTask <span class="token punctuation">{</span>
  NSURLRequest <span class="token operator">*</span>downloadRequest <span class="token operator">=</span> <span class="token punctuation">[</span>NSURLRequest requestWithURL<span class="token punctuation">:</span><span class="token punctuation">[</span>NSURL URLWithString<span class="token punctuation">:</span><span class="token string">@&quot;https://upload.wikimedia.org/wikipedia/commons/f/ff/Pizigani_1367_Chart_10MB.jpg&quot;</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  NSURLSession <span class="token operator">*</span>session <span class="token operator">=</span> <span class="token punctuation">[</span>NSURLSession sessionWithConfiguration<span class="token punctuation">:</span><span class="token punctuation">[</span>NSURLSessionConfiguration defaultSessionConfiguration<span class="token punctuation">]</span>
                                                        delegate<span class="token punctuation">:</span><span class="token keyword">self</span>
                                                   delegateQueue<span class="token punctuation">:</span><span class="token punctuation">[</span>NSOperationQueue mainQueue<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  _downloadTask <span class="token operator">=</span> <span class="token punctuation">[</span>session downloadTaskWithRequest<span class="token punctuation">:</span>downloadRequest<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">[</span>_downloadTask resume<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>You will also need to make your view controller class adhere to the NSURLSessionDownloadDelegate protocol and add in the following stub methods.</p>
<h4 id="swift"><a name="swift" class="plugin-anchor" href="#swift"><i class="fa fa-link" aria-hidden="true"></i></a>Swift:</h4>
<pre class="language-"><code class="lang-swift"><span class="token keyword">class</span> <span class="token class-name">ViewController</span><span class="token punctuation">:</span> <span class="token builtin">UIViewController</span><span class="token punctuation">,</span> <span class="token builtin">URLSessionDownloadDelegate</span> <span class="token punctuation">{</span>
    <span class="token keyword">func</span> <span class="token function">urlSession</span><span class="token punctuation">(</span><span class="token number">_</span> session<span class="token punctuation">:</span> <span class="token builtin">URLSession</span><span class="token punctuation">,</span> downloadTask<span class="token punctuation">:</span> <span class="token builtin">URLSessionDownloadTask</span><span class="token punctuation">,</span> didFinishDownloadingTo location<span class="token punctuation">:</span> <span class="token constant">URL</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// Called when the download is finished.</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">func</span> <span class="token function">urlSession</span><span class="token punctuation">(</span><span class="token number">_</span> session<span class="token punctuation">:</span> <span class="token builtin">URLSession</span><span class="token punctuation">,</span> downloadTask<span class="token punctuation">:</span> <span class="token builtin">URLSessionDownloadTask</span><span class="token punctuation">,</span> didWriteData bytesWritten<span class="token punctuation">:</span> <span class="token builtin">Int64</span><span class="token punctuation">,</span> totalBytesWritten<span class="token punctuation">:</span> <span class="token builtin">Int64</span><span class="token punctuation">,</span> totalBytesExpectedToWrite<span class="token punctuation">:</span> <span class="token builtin">Int64</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment" spellcheck="true">// Called as the download progresses.</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h4 id="objective-c"><a name="objective-c" class="plugin-anchor" href="#objective-c"><i class="fa fa-link" aria-hidden="true"></i></a>Objective-C:</h4>
<pre class="language-"><code class="lang-objectivec"><span class="token keyword">@interface</span> LADownloadTestViewController <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span>NSURLSessionDownloadDelegate<span class="token operator">&gt;</span>

<span class="token keyword">@end</span>

<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>URLSession<span class="token punctuation">:</span><span class="token punctuation">(</span>nonnull NSURLSession <span class="token operator">*</span><span class="token punctuation">)</span>session
      downloadTask<span class="token punctuation">:</span><span class="token punctuation">(</span>nonnull NSURLSessionDownloadTask <span class="token operator">*</span><span class="token punctuation">)</span>downloadTask
didFinishDownloadingToURL<span class="token punctuation">:</span><span class="token punctuation">(</span>nonnull NSURL <span class="token operator">*</span><span class="token punctuation">)</span>location <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// Called when the download is finished.</span>
<span class="token punctuation">}</span>

<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>URLSession<span class="token punctuation">:</span><span class="token punctuation">(</span>NSURLSession <span class="token operator">*</span><span class="token punctuation">)</span>session
      downloadTask<span class="token punctuation">:</span><span class="token punctuation">(</span>NSURLSessionDownloadTask <span class="token operator">*</span><span class="token punctuation">)</span>downloadTask
      didWriteData<span class="token punctuation">:</span><span class="token punctuation">(</span>int64_t<span class="token punctuation">)</span>bytesWritten
 totalBytesWritten<span class="token punctuation">:</span><span class="token punctuation">(</span>int64_t<span class="token punctuation">)</span>totalBytesWritten
totalBytesExpectedToWrite<span class="token punctuation">:</span><span class="token punctuation">(</span>int64_t<span class="token punctuation">)</span>totalBytesExpectedToWrite <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// Called as the download progresses.</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="building-the-ui"><a name="building-the-ui" class="plugin-anchor" href="#building-the-ui"><i class="fa fa-link" aria-hidden="true"></i></a>Building the UI</h2>
<p>Now that we have our download task created, lets create the UI. We will need a single Lottie view for the animation, and a button to start the download. Add the animation&apos;s JSON <a href="../AEP/Boat_Loader.zip">Boat_Loader.json</a> to the App bundle. Create the animation view, and set it to be a full-screen view.</p>
<h4 id="swift"><a name="swift" class="plugin-anchor" href="#swift"><i class="fa fa-link" aria-hidden="true"></i></a>Swift:</h4>
<pre class="language-"><code class="lang-swift"><span class="token keyword">private</span> <span class="token keyword">var</span> boatAnimation<span class="token punctuation">:</span> <span class="token builtin">LOTAnimationView</span><span class="token operator">?</span>

<span class="token keyword">override</span> <span class="token keyword">func</span> <span class="token function">viewDidLoad</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">viewDidLoad</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment" spellcheck="true">// Create Boat Animation</span>
    boatAnimation <span class="token operator">=</span> <span class="token function">LOTAnimationView</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token string">&quot;Boat_Loader&quot;</span><span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true">// Set view to full screen, aspectFill</span>
    boatAnimation<span class="token operator">!</span><span class="token punctuation">.</span>autoresizingMask <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">.</span>flexibleHeight<span class="token punctuation">,</span> <span class="token punctuation">.</span>flexibleWidth<span class="token punctuation">]</span>
    boatAnimation<span class="token operator">!</span><span class="token punctuation">.</span>contentMode <span class="token operator">=</span> <span class="token punctuation">.</span>scaleAspectFill
    boatAnimation<span class="token operator">!</span><span class="token punctuation">.</span>frame <span class="token operator">=</span> view<span class="token punctuation">.</span>bounds
    <span class="token comment" spellcheck="true">// Add the Animation</span>
    view<span class="token punctuation">.</span><span class="token function">addSubview</span><span class="token punctuation">(</span>boatAnimation<span class="token operator">!</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<h4 id="objective-c"><a name="objective-c" class="plugin-anchor" href="#objective-c"><i class="fa fa-link" aria-hidden="true"></i></a>Objective-C</h4>
<pre class="language-"><code class="lang-objectivec"><span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>viewDidLoad <span class="token punctuation">{</span>
    <span class="token punctuation">[</span><span class="token keyword">super</span> viewDidLoad<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">self</span><span class="token punctuation">.</span>view<span class="token punctuation">.</span>backgroundColor <span class="token operator">=</span> <span class="token punctuation">[</span>UIColor whiteColor<span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">// Create Boat Animation</span>
    _boatLoader <span class="token operator">=</span> <span class="token punctuation">[</span>LOTAnimationView animationNamed<span class="token punctuation">:</span><span class="token string">@&quot;Boat_Loader&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// Set view to full screen, aspectFill</span>
    _boatLoader<span class="token punctuation">.</span>autoresizingMask <span class="token operator">=</span> <span class="token punctuation">(</span>UIViewAutoresizingFlexibleWidth <span class="token operator">|</span> UIViewAutoresizingFlexibleHeight<span class="token punctuation">)</span><span class="token punctuation">;</span>
    _boatLoader<span class="token punctuation">.</span>contentMode <span class="token operator">=</span> UIViewContentModeScaleAspectFill<span class="token punctuation">;</span>
    _boatLoader<span class="token punctuation">.</span>frame <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>view<span class="token punctuation">.</span>bounds<span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// Add the Animation</span>
    <span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>view addSubview<span class="token punctuation">:</span>_boatLoader<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Now add a button placed center in the screen that will start the download. Add this to the bottom of the <code>viewDidLoad</code> function. The button will need to call a function when pressed. Add the function that the button calls that will trigger the download.</p>
<h4 id="swift"><a name="swift" class="plugin-anchor" href="#swift"><i class="fa fa-link" aria-hidden="true"></i></a>Swift:</h4>
<pre class="language-"><code class="lang-swift"><span class="token keyword">override</span> <span class="token keyword">func</span> <span class="token function">viewDidLoad</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">viewDidLoad</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">let</span> button <span class="token operator">=</span> <span class="token function">UIButton</span><span class="token punctuation">(</span>type<span class="token punctuation">:</span> <span class="token punctuation">.</span>system<span class="token punctuation">)</span>
    button<span class="token punctuation">.</span><span class="token function">setTitle</span><span class="token punctuation">(</span><span class="token string">&quot;Start Download&quot;</span><span class="token punctuation">,</span> <span class="token keyword">for</span><span class="token punctuation">:</span> <span class="token punctuation">.</span>normal<span class="token punctuation">)</span>
    button<span class="token punctuation">.</span><span class="token function">sizeToFit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    button<span class="token punctuation">.</span>center <span class="token operator">=</span> view<span class="token punctuation">.</span>center
    button<span class="token punctuation">.</span><span class="token function">addTarget</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">,</span> action<span class="token punctuation">:</span> #<span class="token function">selector</span><span class="token punctuation">(</span><span class="token function">startDownload</span><span class="token punctuation">(</span>button<span class="token punctuation">:</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">for</span><span class="token punctuation">:</span> <span class="token punctuation">.</span>touchUpInside<span class="token punctuation">)</span>
    view<span class="token punctuation">.</span><span class="token function">addSubview</span><span class="token punctuation">(</span>button<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token atrule">@objc</span> <span class="token keyword">func</span> <span class="token function">startDownload</span><span class="token punctuation">(</span>button<span class="token punctuation">:</span> <span class="token builtin">UIButton</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    button<span class="token punctuation">.</span>isHidden <span class="token operator">=</span> <span class="token boolean">true</span>
    <span class="token function">createDownloadTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<h4 id="objective-c"><a name="objective-c" class="plugin-anchor" href="#objective-c"><i class="fa fa-link" aria-hidden="true"></i></a>Objective-C</h4>
<pre class="language-"><code class="lang-objectivec"><span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>viewDidLoad <span class="token punctuation">{</span>
    <span class="token punctuation">[</span><span class="token keyword">super</span> viewDidLoad<span class="token punctuation">]</span><span class="token punctuation">;</span>
    UIButton <span class="token operator">*</span>button <span class="token operator">=</span> <span class="token punctuation">[</span>UIButton buttonWithType<span class="token punctuation">:</span>UIButtonTypeSystem<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">[</span>button setTitle<span class="token punctuation">:</span><span class="token string">@&quot;Start Download&quot;</span> forState<span class="token punctuation">:</span>UIControlStateNormal<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">[</span>button sizeToFit<span class="token punctuation">]</span><span class="token punctuation">;</span>
    button<span class="token punctuation">.</span>center <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>view<span class="token punctuation">.</span>center<span class="token punctuation">;</span>
    <span class="token punctuation">[</span>button addTarget<span class="token punctuation">:</span><span class="token keyword">self</span> action<span class="token punctuation">:</span><span class="token keyword">@selector</span><span class="token punctuation">(</span>startDownload<span class="token punctuation">:</span><span class="token punctuation">)</span> forControlEvents<span class="token punctuation">:</span>UIControlEventTouchUpInside<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>view addSubview<span class="token punctuation">:</span>button<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>startDownload<span class="token punctuation">:</span><span class="token punctuation">(</span>UIButton <span class="token operator">*</span><span class="token punctuation">)</span>sender <span class="token punctuation">{</span>
  sender<span class="token punctuation">.</span>hidden <span class="token operator">=</span> YES<span class="token punctuation">;</span>
  <span class="token punctuation">[</span><span class="token keyword">self</span> createDownloadTask<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="making-it-all-move"><a name="making-it-all-move" class="plugin-anchor" href="#making-it-all-move"><i class="fa fa-link" aria-hidden="true"></i></a>Making it all move</h2>
<p>If you run the App now you should see a boat sitting on a wave. If you click on the download button the image will download, but the animation never plays. Lets wire it all up!</p>
<p><img src="Boat_Loader_Props.png" alt="Boat_Loader_Props"></p>
<p>First, let&apos;s look closer at the After Effects file. The animation has a layer named <code>Boat</code> which contains the boat and the rolling waves. We want to move this layer up the screen as the download progresses. We need to drive the position of the <code>Boat</code> layer with the progress of the download. Looking at the After Effects file we can see that the property we want to change is <code>Boat.Transform.Position</code> In order to change an animation we need two things. A <code>LOTKeypath</code> and a <code>LOTValueDelegate</code>.</p>
<p>A <code>LOTKeypath</code> is used to match views inside of a LOTAnimation to their counterparts in After Effects. Properties in After Effects are nested (Layer -&gt; Objects -&gt; Animatable Properties). <code>LOTKeypath</code> is used to search through the animation data to find the properties to change. They can be constructed explicitly (&quot;Circle Layer.Circle Shape.Fill.Color&quot;) or with wild-cards (&quot;**.Fill.Color&quot; will find all color properties belonging to objects named <code>Fill</code>). For more information see the documentation for <code>LOTKeypath</code>.</p>
<p><code>LOTValueDelegate</code> is a protocol that is called for a specific keypath as an animation plays. It can override the keypath&apos;s data by returning new data for the keypath. There are several subclasses of <code>LOTValueDelegate</code>, one for each primitive type: Color, Number, Point, Size, and Path. There are also pre-built objects that adhere to <code>LOTValueDelegate</code> to perform basic animation driving functions. The pre-built objects come in three flavors each with subclasses for each primitive: <code>LOTValueCallback</code>, <code>LOTBlockCallback</code>, <code>LOTInterpolatorCallback</code>. For this excercise we will use a <code>LOTInterpolatorCallback</code>. For more information see the documentation for <code>LOTValueCallback</code>, <code>LOTBlockCallback</code>, <code>LOTInterpolatorCallback</code>.</p>
<p>Lets set up our <code>LOTInterpolatorCallback</code>. A <code>LOTInterpolatorCallback</code> contains a <code>startPoint</code>, an <code>endPoint</code>, and a <code>currentProgress</code> property. As the <code>currentProgress</code> property is driven from 0 to 1, the interpolator will move the animation property specified by the keypath from the <code>startPoint</code> to the <code>endPoint</code>. We will want the boat layer to move from the center of the screen up one entire screen height. Its important to note that Lottie maintains a weak reference to any delegate added. The view controller will hold the interpolator since it needs to make changes as the download progresses.</p>
<p>Dynamic properties work in the animation&apos;s coordinate space, so we will have to convert the screen coordinates into the <code>Boat</code> layer coordinates using the <code>convertPoint:toKeypathLayer</code> function on <code>LOTAnimationView</code>. This function finds the layer at the specified keypath and converts the given point from the animation&apos;s parent view coordinate space into the layers coordinate space.</p>
<p>Add this at the bottom of <code>viewDidLoad</code>.</p>
<h4 id="swift"><a name="swift" class="plugin-anchor" href="#swift"><i class="fa fa-link" aria-hidden="true"></i></a>Swift:</h4>
<pre class="language-"><code class="lang-swift"><span class="token comment" spellcheck="true">// The center of the screen, where the boat will start</span>
<span class="token keyword">let</span> screenCenter <span class="token operator">=</span> <span class="token function">CGPoint</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span>view<span class="token punctuation">.</span>bounds<span class="token punctuation">.</span>midX<span class="token punctuation">,</span> y<span class="token punctuation">:</span>view<span class="token punctuation">.</span>bounds<span class="token punctuation">.</span>midY<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">// The center one screen height above the screen. Where the boat will end up when the download completes</span>
<span class="token keyword">let</span> offscreenCenter <span class="token operator">=</span> <span class="token function">CGPoint</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span>view<span class="token punctuation">.</span>bounds<span class="token punctuation">.</span>midX<span class="token punctuation">,</span> y<span class="token punctuation">:</span><span class="token operator">-</span>view<span class="token punctuation">.</span>bounds<span class="token punctuation">.</span>midY<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">// Convert points into animation view coordinate space.</span>
<span class="token keyword">let</span> boatStartPoint <span class="token operator">=</span> boatAnimation<span class="token operator">!</span><span class="token punctuation">.</span><span class="token function">convert</span><span class="token punctuation">(</span>screenCenter<span class="token punctuation">,</span> toKeypathLayer<span class="token punctuation">:</span> <span class="token function">LOTKeypath</span><span class="token punctuation">(</span>string<span class="token punctuation">:</span> <span class="token string">&quot;Boat&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> boatEndPoint <span class="token operator">=</span> boatAnimation<span class="token operator">!</span><span class="token punctuation">.</span><span class="token function">convert</span><span class="token punctuation">(</span>offscreenCenter<span class="token punctuation">,</span> toKeypathLayer<span class="token punctuation">:</span> <span class="token function">LOTKeypath</span><span class="token punctuation">(</span>string<span class="token punctuation">:</span> <span class="token string">&quot;Boat&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">// Set up out interpolator, to be driven by the download callback</span>
positionInterpolator <span class="token operator">=</span> <span class="token function">LOTPointInterpolatorCallback</span><span class="token punctuation">(</span>from<span class="token punctuation">:</span> boatStartPoint<span class="token punctuation">,</span> to<span class="token punctuation">:</span> boatEndPoint<span class="token punctuation">)</span>
</code></pre>
<h4 id="objective-c"><a name="objective-c" class="plugin-anchor" href="#objective-c"><i class="fa fa-link" aria-hidden="true"></i></a>Objective-C</h4>
<pre class="language-"><code class="lang-objectivec"><span class="token comment" spellcheck="true">// The center of the screen</span>
CGPoint screenCenter <span class="token operator">=</span> <span class="token function">CGPointMake</span><span class="token punctuation">(</span><span class="token function">CGRectGetMidX</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>view<span class="token punctuation">.</span>bounds<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">CGRectGetMidY</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>view<span class="token punctuation">.</span>bounds<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// The center one screen height above the screen.</span>
CGPoint offscreenCenter <span class="token operator">=</span> <span class="token function">CGPointMake</span><span class="token punctuation">(</span>screenCenter<span class="token punctuation">.</span>x<span class="token punctuation">,</span> <span class="token operator">-</span>screenCenter<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>

LOTKeypath <span class="token operator">*</span>boatKeypath <span class="token operator">=</span> <span class="token punctuation">[</span>LOTKeypath keypathWithString<span class="token punctuation">:</span><span class="token string">@&quot;Boat&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// Convert points into animation view coordinate space.</span>
CGPoint boatStartPoint <span class="token operator">=</span> <span class="token punctuation">[</span>_boatLoader convertPoint<span class="token punctuation">:</span>screenCenter toKeypathLayer<span class="token punctuation">:</span>boatKeypath<span class="token punctuation">]</span><span class="token punctuation">;</span>
CGPoint boatEndPoint <span class="token operator">=</span> <span class="token punctuation">[</span>_boatLoader convertPoint<span class="token punctuation">:</span>offscreenCenter toKeypathLayer<span class="token punctuation">:</span>boatKeypath<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// Set up out interpolator, to be driven by the download callback</span>
_positionInterpolator <span class="token operator">=</span> <span class="token punctuation">[</span>LOTPointInterpolatorCallback withFromPoint<span class="token punctuation">:</span>boatStartPoint toPoint<span class="token punctuation">:</span>boatEndPoint<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre>
<p>Now that we have a <code>_positionInterpolator</code> lets set it on the <code>Boat.Transform.Position</code> property of animation view and tell the animation view to loop the first half of the animation.</p>
<h4 id="swift"><a name="swift" class="plugin-anchor" href="#swift"><i class="fa fa-link" aria-hidden="true"></i></a>Swift:</h4>
<pre class="language-"><code class="lang-swift"><span class="token comment" spellcheck="true">// Set the interpolator on the animation view for the Boat.Transform.Position keypath.</span>
boatAnimation<span class="token operator">!</span><span class="token punctuation">.</span><span class="token function">setValueDelegate</span><span class="token punctuation">(</span>positionInterpolator<span class="token operator">!</span><span class="token punctuation">,</span> <span class="token keyword">for</span><span class="token punctuation">:</span><span class="token function">LOTKeypath</span><span class="token punctuation">(</span>string<span class="token punctuation">:</span> <span class="token string">&quot;Boat.Transform.Position&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">//Play the first portion of the animation on loop until the download finishes.</span>
boatAnimation<span class="token operator">!</span><span class="token punctuation">.</span>loopAnimation <span class="token operator">=</span> <span class="token boolean">true</span>
boatAnimation<span class="token operator">!</span><span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span>fromProgress<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
                    toProgress<span class="token punctuation">:</span> <span class="token number">0.5</span><span class="token punctuation">,</span>
                    withCompletion<span class="token punctuation">:</span> <span class="token constant">nil</span><span class="token punctuation">)</span>
</code></pre>
<h4 id="objective-c"><a name="objective-c" class="plugin-anchor" href="#objective-c"><i class="fa fa-link" aria-hidden="true"></i></a>Objective-C</h4>
<pre class="language-"><code class="lang-objectivec"><span class="token comment" spellcheck="true">// Set the interpolator on the animation view for the Boat.Transform.Position keypath.</span>
<span class="token punctuation">[</span>_boatLoader setValueDelegate<span class="token punctuation">:</span>_positionInterpolator forKeypath<span class="token punctuation">:</span><span class="token punctuation">[</span>LOTKeypath keypathWithKeys<span class="token punctuation">:</span><span class="token string">@&quot;Boat&quot;</span><span class="token punctuation">,</span> <span class="token string">@&quot;Transform&quot;</span><span class="token punctuation">,</span> <span class="token string">@&quot;Position&quot;</span><span class="token punctuation">,</span> nil<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">//Play the first portion of the animation on loop until the download finishes.</span>
_boatLoader<span class="token punctuation">.</span>loopAnimation <span class="token operator">=</span> YES<span class="token punctuation">;</span>
<span class="token punctuation">[</span>_boatLoader playFromProgress<span class="token punctuation">:</span><span class="token number">0</span> toProgress<span class="token punctuation">:</span><span class="token number">0.5</span> withCompletion<span class="token punctuation">:</span>nil<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre>
<p>Now, if you run the App you should see the boat moving over the waves indefinitely. If you press the download button, the boat will continue to move over the waves but nothing else happens. We need to hook the download progress up to the <code>_positionInterpolator</code> in the request&apos;s delegate callback.</p>
<h4 id="swift"><a name="swift" class="plugin-anchor" href="#swift"><i class="fa fa-link" aria-hidden="true"></i></a>Swift:</h4>
<pre class="language-"><code class="lang-swift"><span class="token keyword">func</span> <span class="token function">urlSession</span><span class="token punctuation">(</span><span class="token number">_</span> session<span class="token punctuation">:</span> <span class="token builtin">URLSession</span><span class="token punctuation">,</span> downloadTask<span class="token punctuation">:</span> <span class="token builtin">URLSessionDownloadTask</span><span class="token punctuation">,</span> didWriteData bytesWritten<span class="token punctuation">:</span> <span class="token builtin">Int64</span><span class="token punctuation">,</span> totalBytesWritten<span class="token punctuation">:</span> <span class="token builtin">Int64</span><span class="token punctuation">,</span> totalBytesExpectedToWrite<span class="token punctuation">:</span> <span class="token builtin">Int64</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    positionInterpolator<span class="token operator">?</span><span class="token punctuation">.</span>currentProgress <span class="token operator">=</span> <span class="token function">CGFloat</span><span class="token punctuation">(</span>totalBytesWritten<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token function">CGFloat</span><span class="token punctuation">(</span>totalBytesExpectedToWrite<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<h4 id="objective-c"><a name="objective-c" class="plugin-anchor" href="#objective-c"><i class="fa fa-link" aria-hidden="true"></i></a>Objective-C</h4>
<pre class="language-"><code class="lang-objectivec"><span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>URLSession<span class="token punctuation">:</span><span class="token punctuation">(</span>NSURLSession <span class="token operator">*</span><span class="token punctuation">)</span>session
      downloadTask<span class="token punctuation">:</span><span class="token punctuation">(</span>NSURLSessionDownloadTask <span class="token operator">*</span><span class="token punctuation">)</span>downloadTask
      didWriteData<span class="token punctuation">:</span><span class="token punctuation">(</span>int64_t<span class="token punctuation">)</span>bytesWritten
 totalBytesWritten<span class="token punctuation">:</span><span class="token punctuation">(</span>int64_t<span class="token punctuation">)</span>totalBytesWritten
totalBytesExpectedToWrite<span class="token punctuation">:</span><span class="token punctuation">(</span>int64_t<span class="token punctuation">)</span>totalBytesExpectedToWrite <span class="token punctuation">{</span>
  _positionInterpolator<span class="token punctuation">.</span>currentProgress <span class="token operator">=</span> <span class="token punctuation">(</span>CGFloat<span class="token punctuation">)</span>totalBytesWritten <span class="token operator">/</span> <span class="token punctuation">(</span>CGFloat<span class="token punctuation">)</span>totalBytesExpectedToWrite<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Run the App and press download. You should see the water filling the screen as the download progresses! Fantastic! We&apos;re almost done! When the download finishes the animation should play through the current loop, then play the last half of the animation, which will notify the success of the download.</p>
<h4 id="swift"><a name="swift" class="plugin-anchor" href="#swift"><i class="fa fa-link" aria-hidden="true"></i></a>Swift:</h4>
<pre class="language-"><code class="lang-swift"><span class="token keyword">func</span> <span class="token function">urlSession</span><span class="token punctuation">(</span><span class="token number">_</span> session<span class="token punctuation">:</span> <span class="token builtin">URLSession</span><span class="token punctuation">,</span> downloadTask<span class="token punctuation">:</span> <span class="token builtin">URLSessionDownloadTask</span><span class="token punctuation">,</span> didFinishDownloadingTo location<span class="token punctuation">:</span> <span class="token constant">URL</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// Pause the animation and disable looping.</span>
    boatAnimation<span class="token operator">!</span><span class="token punctuation">.</span><span class="token function">pause</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    boatAnimation<span class="token operator">!</span><span class="token punctuation">.</span>loopAnimation <span class="token operator">=</span> <span class="token boolean">false</span>
    <span class="token comment" spellcheck="true">// Speed up animation to finish out the current loop.</span>
    boatAnimation<span class="token operator">!</span><span class="token punctuation">.</span>animationSpeed <span class="token operator">=</span> <span class="token number">4</span>

    boatAnimation<span class="token operator">!</span><span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span>toProgress<span class="token punctuation">:</span> <span class="token number">0.5</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">[</span><span class="token keyword">weak</span> <span class="token keyword">self</span><span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">_</span><span class="token punctuation">)</span> <span class="token keyword">in</span>
      <span class="token comment" spellcheck="true">// At this time the animation is at the halfway point. Reset sped to 1 and play through the completion animation.</span>
      <span class="token keyword">self</span><span class="token operator">?</span><span class="token punctuation">.</span>boatAnimation<span class="token operator">!</span><span class="token punctuation">.</span>animationSpeed <span class="token operator">=</span> <span class="token number">1</span>
      <span class="token keyword">self</span><span class="token operator">?</span><span class="token punctuation">.</span>boatAnimation<span class="token operator">!</span><span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span>toProgress<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> withCompletion<span class="token punctuation">:</span> <span class="token constant">nil</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre>
<h4 id="objective-c"><a name="objective-c" class="plugin-anchor" href="#objective-c"><i class="fa fa-link" aria-hidden="true"></i></a>Objective-C</h4>
<pre class="language-"><code class="lang-objectivec"><span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>URLSession<span class="token punctuation">:</span><span class="token punctuation">(</span>nonnull NSURLSession <span class="token operator">*</span><span class="token punctuation">)</span>session
      downloadTask<span class="token punctuation">:</span><span class="token punctuation">(</span>nonnull NSURLSessionDownloadTask <span class="token operator">*</span><span class="token punctuation">)</span>downloadTask
didFinishDownloadingToURL<span class="token punctuation">:</span><span class="token punctuation">(</span>nonnull NSURL <span class="token operator">*</span><span class="token punctuation">)</span>location <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">// Pause the animation and disable looping.</span>
  <span class="token punctuation">[</span>_boatLoader pause<span class="token punctuation">]</span><span class="token punctuation">;</span>
  _boatLoader<span class="token punctuation">.</span>loopAnimation <span class="token operator">=</span> NO<span class="token punctuation">;</span>
  <span class="token comment" spellcheck="true">// Speed up animation to finish out the current loop.</span>
  _boatLoader<span class="token punctuation">.</span>animationSpeed <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>
  <span class="token punctuation">[</span>_boatLoader playToProgress<span class="token punctuation">:</span><span class="token number">0.5</span> withCompletion<span class="token punctuation">:</span><span class="token operator">^</span><span class="token punctuation">(</span>BOOL animationFinished<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// At this time the animation is at the halfway point. Reset sped to 1 and play through the completion animation.</span>
    _boatLoader<span class="token punctuation">.</span>animationSpeed <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">[</span>_boatLoader playToProgress<span class="token punctuation">:</span><span class="token number">1</span> withCompletion<span class="token punctuation">:</span>nil<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Run the App, and now you should see the completion animation!</p>
<h2 id="conclusion"><a name="conclusion" class="plugin-anchor" href="#conclusion"><i class="fa fa-link" aria-hidden="true"></i></a>Conclusion</h2>
<p>Hopefully this has shown some of the power of dynamic properties with Lottie! This is only a small example of what can be achieved. Read the documentation on dynamic properties to see what else you can do. Happy animating!</p>

                                
                                </section>
                            
                        </div>
                    </div>
                
            </div>

            
                
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Building a Dynamic Progress Loader","level":"1.3.2.1","depth":3,"next":{"title":"Troubleshooting","level":"1.3.3","depth":2,"ref":"","articles":[{"title":"Performance","level":"1.3.3.1","depth":3,"path":"ios/performance.md","ref":"ios/performance.md","articles":[]},{"title":"Troubleshooting","level":"1.3.3.2","depth":3,"path":"ios/troubleshooting.md","ref":"ios/troubleshooting.md","articles":[]}]},"previous":{"title":"Tutorials","level":"1.3.2","depth":2,"ref":"","articles":[{"title":"Building a Dynamic Progress Loader","level":"1.3.2.1","depth":3,"path":"ios/dynamic_properties.md","ref":"ios/dynamic_properties.md","articles":[]}]},"dir":"ltr"},"config":{"plugins":["edit-link","prism@2.3.0","-highlight","github","-search","codeblock-disable-glossary","collapsible-chapters","anchors"],"root":"./docs","styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"prism":{},"github":{"url":"https://github.com/airbnb/lottie/"},"collapsible-chapters":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"codeblock-disable-glossary":{},"fontsettings":{"theme":"white","family":"sans","size":2},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"edit-link":{"label":"Edit This Page","base":"https://github.com/airbnb/lottie/edit/lottie-docs/docs/"},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false},"anchors":{}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{"androidVersion":"2.5.1","iosVersion":"2.5.0","reactNativeVersion":"2.3.2"},"title":"Lottie","gitbook":"3.2.3","description":"After Effects Animations for Android, iOS, React Native, and Web"},"file":{"path":"ios/dynamic_properties.md","mtime":"2018-03-24T18:10:56.515Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2018-08-13T01:26:58.596Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-edit-link/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-github/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-codeblock-disable-glossary/disable-glossary.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-collapsible-chapters/collapsible-chapters.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

